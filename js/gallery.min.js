/*
 * This is mrsi-gallery - a full-screen image gallery that takes advantage of the modern browser technologies.
 * Get it at https://github.com/mrfoto/mrsi-gallery
 *
 * The MIT License (MIT). Copyright (c) 2011 Miha Rekar <info@mr.si>
 */(function(e,t,n){"use strict";var r=function(t){var n={images:[],shuffle:!1,transitionTime:1e3,type:"cover",cssTransitions:!1},r=this,i=function(){r.oldDiv.remove();r.running=!1},s=function(){r.running=!1};t=e.extend({},n,t);this.setImages(t.images,t.shuffle);this.detectTransitionType();this.setTransitionTime(t.transitionTime);this.type=t.type;this.enableCSSTransitions(t.cssTransitions);this.emptyTransitionClass={transition:"","-moz-transition":"","-webkit-transition":"","-o-transition":""};this.hiddenImg.load(function(){if(!r.running)return;r.addBackgroundImage(r.images[r.current]);r.loadingDiv.hide();r.oldDiv!==null?r.transitionType?r.oldDiv.css(r.transitionClass).addClass("fadeout").on(r.transitionType,i):r.oldDiv.fadeOut(r.transitionTime,i):r.transitionType?setTimeout(function(){r.backgroundDiv.css(r.transitionClass).on(r.transitionType,s).removeClass("fadeout")},0):r.backgroundDiv.fadeIn(r.transitionTime,s)});this.running=!0;this.hiddenImg.attr("src",this.images[this.current])},i;r.prototype.emptyDiv='<div class="background new"></div>';r.prototype.oldDiv=null;r.prototype.hiddenImg=e('<img id="hiddenImg"/>').appendTo("body");r.prototype.loadingDiv=e('<div id="loading"></div>').appendTo("body");r.prototype.setTransitionTime=function(e){this.transitionTime=parseInt(e,10);e+="ms";this.transitionClass={transition:e,"-moz-transition":e,"-webkit-transition":e,"-o-transition":e}};r.prototype.enableCSSTransitions=function(e){this.transitionType=e?this.detectTransitionType():!1;!this.transitionType&&this.backgroundDiv&&this.backgroundDiv.css(this.emptyTransitionClass)};i=function(e){var t,n=e.slice(),r=n.length,i;while(r){r-=1;i=Math.round(Math.random()*r);t=n[i];n[i]=n[r];n[r]=t}return n};r.prototype.setImages=function(e,t){t&&(e=i(e));this.images=e;this.imagesMax=this.images.length-1;this.current=0};r.prototype.setNewImages=function(t){var n={images:[],shuffle:!1},r;t=e.extend({},n,t);r=this.images[this.current];this.setImages(t.images,t.shuffle);r!==this.images[this.current]&&this.changeImage()};r.prototype.toggleType=function(){var n=this,r;if(!this.running){r=this.type;this.running=!0;this.type=this.type==="cover"?"contain":"cover";n.transitionType?this.backgroundDiv.css(n.transitionClass).addClass("fadeout").on(this.transitionType,function(){e(this).removeClass(r);t.backgroundsize||n.resizeImage();e(this).addClass(n.type).removeClass("fadeout").off(n.transitionType).on(n.transitionType,function(){n.running=!1;e(this).off(n.transitionType)})}):this.backgroundDiv.fadeOut(n.transitionTime,function(){e(this).removeClass(r);t.backgroundsize||n.resizeImage();e(this).addClass(n.type).fadeIn(n.transitionTime,function(){n.running=!1})})}return};r.prototype.next=function(){if(this.running)return;this.current=this.current===this.imagesMax?0:this.current+1;return this.changeImage()};r.prototype.previous=function(){if(this.running)return;this.current=this.current===0?this.imagesMax:this.current-1;return this.changeImage()};r.prototype.changeTo=function(e){if(e<=this.imagesMax&&e>=0&&e!==this.current){this.current=e;return this.changeImage()}return};r.prototype.detectTransitionType=function(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return t.csstransitions?e[t.prefixed("transition")]:!1};r.prototype.addBackgroundImage=function(i){this.backgroundDiv===undefined&&(this.transitionType?this.backgroundDiv=e(r.prototype.emptyDiv).addClass("fadeout").appendTo("body"):this.backgroundDiv=e(r.prototype.emptyDiv).hide().appendTo("body"));var s=this.backgroundDiv;if(!t.backgroundsize){s.append('<img class="resizableImage" src="'+i+'">');this.resizeImage();e(n).resize(this.resizeImage)}else s.css("background-image","url("+i+")").addClass(this.type)};r.prototype.resizeImage=function(){var t=e("img.resizableImage"),r=t.parent(),i=t.width(),s=t.height(),o=i/s,u=n.innerWidth,a=n.innerHeight,f=u/a,l=0,c=0;if(isNaN(f)){u=n.document.documentElement.clientWidth;a=n.document.documentElement.clientHeight;f=u/a}if(this.type==="contain")if(o>f){s=u*s/i;i=u;c=(a-s)/2}else{i=a*i/s;s=a;l=(u-i)/2}else if(o>f){i=a*i/s;s=a;l=(u-i)/2}else{s=u*s/i;i=u;c=(a-s)/2}r.width(u).height(a).css("overflow","hidden");t.attr("width",i).attr("height",s).css("margin",c+"px 0px 0px "+l+"px")};r.prototype.changeImage=function(){var t=this;if(!this.running){this.oldDiv=this.backgroundDiv;this.backgroundDiv=e(this.emptyDiv).insertBefore(this.oldDiv);this.running=!0;this.loadingDiv.show();this.oldDiv.addClass("old").removeClass("new");this.hiddenImg.attr("src",t.images[t.current]);return}return};n.Gallery=r})(jQuery,Modernizr,window);