(function(d,c){var a=function(g){var e={images:[],shuffle:false,transitionTime:1000,type:"cover",keyboardShortcuts:false};var g=d.extend({},e,g);this.setImages(g.images,g.shuffle);this.detectTerribleBrowser();this.setTransitionTime(g.transitionTime);this.type=g.type;if(g.keyboardShortcuts){this.setKeyboardShortcuts()}var f=this;this.hiddenImg.load(function(){if(!f.running){return}f.addBackgroundImage(f.images[f.current]);f.loadingDiv.hide();if(f.oldDiv!==null){f.oldDiv.fadeOut(f.transitionTime,function(){d(this).remove();f.running=false})}else{f.backgroundDiv.fadeIn(f.transitionTime,function(){f.running=false})}});this.running=true;this.hiddenImg.attr("src",this.images[this.current])};a.prototype.emptyDiv='<div class="background new"></div>';a.prototype.backgroundDiv=d(a.prototype.emptyDiv).hide().appendTo("body");a.prototype.oldDiv=null;a.prototype.hiddenImg=d('<img id="hiddenImg"/>').appendTo("body");a.prototype.loadingDiv=d('<div id="loading"></div>').appendTo("body");a.prototype.setImages=function(e,f){if(f){e=b(e)}this.images=e;this.imagesMax=this.images.length-1;this.current=0};a.prototype.setNewImages=function(g){var e={images:[],shuffle:false};var g=d.extend({},e,g);var f=this.images[this.current];this.setImages(g.images,g.shuffle);if(f!==this.images[this.current]){this.changeImage()}};a.prototype.toggleType=function(){var e=this;if(!this.running&&!this.isTerribleBrowser){var f=this.type;this.running=true;this.type=(this.type==="cover")?"contain":"cover";this.backgroundDiv.fadeOut("",function(){d(this).removeClass(f).addClass(e.type).fadeIn("",function(){e.running=false})});return true}return};a.prototype.next=function(){if(this.running){return}this.current=(this.current===this.imagesMax)?0:this.current+1;return this.changeImage()};a.prototype.previous=function(){if(this.running){return}this.current=(this.current===0)?this.imagesMax:this.current-1;return this.changeImage()};a.prototype.changeTo=function(e){if(e<=this.imagesMax&&e>=0&&e!==this.current){this.current=e;return this.changeImage()}return};a.prototype.detectTerribleBrowser=function(){if(/MSIE (\d+\.\d+);/.test(c.navigator.userAgent)){this.isTerribleBrowser=parseFloat(RegExp.$1,10)<9}};a.prototype.addBackgroundImage=function(g){var f=this.backgroundDiv;if(this.isTerribleBrowser){var e="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+g+"', sizingMethod='scale')";f.css({filter:e,"-ms-filter":e})}else{f.css("background-image","url("+g+")").addClass(this.type)}};a.prototype.changeImage=function(){var e=this;if(!this.running){this.oldDiv=this.backgroundDiv;this.backgroundDiv=d(this.emptyDiv).insertBefore(this.oldDiv);this.running=true;this.loadingDiv.show();this.oldDiv.addClass("old").removeClass("new");this.hiddenImg.attr("src",e.images[e.current]);return true}return};a.prototype.setKeyboardShortcuts=function(){var e=this;d(c.document.documentElement).keyup(function(f){if(!this.running){if(f.keyCode===39||f.keyCode===38){e.next()}if(f.keyCode===37||f.keyCode===40){e.previous()}}})};a.prototype.setTransitionTime=function(e){this.transitionTime=parseInt(e,10)};var b=function(e){var k,h=e.slice(),g=h.length,f;while(--g){f=Math.round(Math.random()*g);k=h[f];h[f]=h[g];h[g]=k}return h};c.gallery=a})(jQuery,window);