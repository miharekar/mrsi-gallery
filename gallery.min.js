(function(e,t,n){"use strict";var r,i=function(t){var r={images:[],shuffle:!1,transitionTime:1e3,type:"cover",cssTransitions:!1},i=this,s=function(){i.oldDiv.remove();i.running=!1},o=function(){i.running=!1};t=e.extend({},r,t);this.setImages(t.images,t.shuffle);this.detectTransitionType();this.setTransitionTime(t.transitionTime);this.type=t.type;this.enableCSSTransitions(t.cssTransitions);this.emptyTransitionClass={transition:"","-moz-transition":"","-webkit-transition":"","-o-transition":""};this.hiddenImg.load(function(){if(!i.running)return;i.addBackgroundImage(i.images[i.current]);i.loadingDiv.hide();if(i.oldDiv!==null)i.transitionType?i.oldDiv.css(i.transitionClass).addClass("fadeout").on(i.transitionType,s):i.oldDiv.fadeOut(i.transitionTime,s);else if(i.transitionType){n.tempFadeoutFix=i.backgroundDiv.css(i.transitionClass).on(i.transitionType,o);setTimeout("window.tempFadeoutFix.removeClass('fadeout')",0)}else i.backgroundDiv.fadeIn(i.transitionTime,o)});this.running=!0;this.hiddenImg.attr("src",this.images[this.current])};i.prototype.emptyDiv='<div class="background new"></div>';i.prototype.oldDiv=null;i.prototype.hiddenImg=e('<img id="hiddenImg"/>').appendTo("body");i.prototype.loadingDiv=e('<div id="loading"></div>').appendTo("body");i.prototype.setTransitionTime=function(e){this.transitionTime=parseInt(e,10);e+="ms";this.transitionClass={transition:e,"-moz-transition":e,"-webkit-transition":e,"-o-transition":e}};i.prototype.enableCSSTransitions=function(e){this.transitionType=e?this.detectTransitionType():!1;this.transitionType||this.backgroundDiv.css(this.emptyTransitionClass)};r=function(e){var t,n,r=e.slice(),i=r.length;while(i){i-=1;n=Math.round(Math.random()*i);t=r[n];r[n]=r[i];r[i]=t}return r};i.prototype.setImages=function(e,t){t&&(e=r(e));this.images=e;this.imagesMax=this.images.length-1;this.current=0};i.prototype.setNewImages=function(t){var n,r={images:[],shuffle:!1};t=e.extend({},r,t);n=this.images[this.current];this.setImages(t.images,t.shuffle);n!==this.images[this.current]&&this.changeImage()};i.prototype.toggleType=function(){var n,r=this;if(!this.running){n=this.type;this.running=!0;this.type=this.type==="cover"?"contain":"cover";r.transitionType?this.backgroundDiv.css(r.transitionClass).addClass("fadeout").on(this.transitionType,function(){e(this).removeClass(n);t.backgroundsize||r.resizeImage();e(this).addClass(r.type).removeClass("fadeout").off(r.transitionType).on(r.transitionType,function(){r.running=!1;e(this).off(r.transitionType)})}):this.backgroundDiv.fadeOut(r.transitionTime,function(){e(this).removeClass(n);t.backgroundsize||r.resizeImage();e(this).addClass(r.type).fadeIn(r.transitionTime,function(){r.running=!1})})}return};i.prototype.next=function(){if(this.running)return;this.current=this.current===this.imagesMax?0:this.current+1;return this.changeImage()};i.prototype.previous=function(){if(this.running)return;this.current=this.current===0?this.imagesMax:this.current-1;return this.changeImage()};i.prototype.changeTo=function(e){if(e<=this.imagesMax&&e>=0&&e!==this.current){this.current=e;return this.changeImage()}return};i.prototype.detectTransitionType=function(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionEnd"};return t.csstransitions?e[t.prefixed("transition")]:!1};i.prototype.addBackgroundImage=function(r){var s;this.backgroundDiv===undefined&&(this.transitionType?this.backgroundDiv=e(i.prototype.emptyDiv).addClass("fadeout").appendTo("body"):this.backgroundDiv=e(i.prototype.emptyDiv).hide().appendTo("body"));s=this.backgroundDiv;if(!t.backgroundsize){s.append('<img class="resizableImage" src="'+r+'">');this.resizeImage();e(n).resize(this.resizeImage)}else s.css("background-image","url("+r+")").addClass(this.type)};i.prototype.resizeImage=function(){var t=e("img.resizableImage"),r=t.parent(),i=t.width(),s=t.height(),o=i/s,u=n.innerWidth,a=n.innerHeight,f=u/a,l=0,c=0;if(isNaN(f)){u=n.document.documentElement.clientWidth;a=n.document.documentElement.clientHeight;f=u/a}if(this.type==="contain")if(o>f){s=u*s/i;i=u;c=(a-s)/2}else{i=a*i/s;s=a;l=(u-i)/2}else if(o>f){i=a*i/s;s=a;l=(u-i)/2}else{s=u*s/i;i=u;c=(a-s)/2}r.width(u).height(a).css("overflow","hidden");t.attr("width",i).attr("height",s).css("margin",c+"px 0px 0px "+l+"px")};i.prototype.changeImage=function(){var t=this;if(!this.running){this.oldDiv=this.backgroundDiv;this.backgroundDiv=e(this.emptyDiv).insertBefore(this.oldDiv);this.running=!0;this.loadingDiv.show();this.oldDiv.addClass("old").removeClass("new");this.hiddenImg.attr("src",t.images[t.current]);return}return};n.Gallery=i})(jQuery,Modernizr,window);