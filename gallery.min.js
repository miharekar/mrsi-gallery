/*
 * This is mrsi-gallery - a full-screen image gallery that takes advantage of the modern browser technologies.
 * Get it at https://github.com/mrfoto/mrsi-gallery
 *
 * The MIT License (MIT). Copyright (c) 2011 Miha Rekar <info@mr.si>
 */
(function(d,e,c){var a=function(i){var f={images:[],shuffle:false,transitionTime:1000,type:"cover",cssTransitions:false},h=this,g=function(){h.oldDiv.remove();h.running=false},j=function(){h.running=false};i=d.extend({},f,i);this.setImages(i.images,i.shuffle);this.detectTransitionType();this.setTransitionTime(i.transitionTime);this.type=i.type;this.enableCSSTransitions(i.cssTransitions);this.hiddenImg.load(function(){if(!h.running){return}h.addBackgroundImage(h.images[h.current]);h.loadingDiv.hide();if(h.oldDiv!==null){if(h.transitionType){h.oldDiv.css(h.transitionClass).addClass("fadeout").bind(h.transitionType,g)}else{h.oldDiv.fadeOut(h.transitionTime,g)}}else{if(h.transitionType){h.backgroundDiv.css(h.transitionClass).removeClass("fadeout").bind(h.transitionType,j)}else{h.backgroundDiv.fadeIn(h.transitionTime,j)}}});this.running=true;this.hiddenImg.attr("src",this.images[this.current])},b;a.prototype.emptyDiv='<div class="background new"></div>';a.prototype.oldDiv=null;a.prototype.hiddenImg=d('<img id="hiddenImg"/>').appendTo("body");a.prototype.loadingDiv=d('<div id="loading"></div>').appendTo("body");a.prototype.setTransitionTime=function(f){this.transitionTime=parseInt(f,10);f=f+"ms";this.transitionClass={transition:f,"-moz-transition":f,"-webkit-transition":f,"-o-transition":f}};a.prototype.enableCSSTransitions=function(f){this.transitionType=f?this.detectTransitionType():false};b=function(f){var l,k=f.slice(),h=k.length,g;while(h){h=h-1;g=Math.round(Math.random()*h);l=k[g];k[g]=k[h];k[h]=l}return k};a.prototype.setImages=function(f,g){if(g){f=b(f)}this.images=f;this.imagesMax=this.images.length-1;this.current=0};a.prototype.setNewImages=function(h){var f={images:[],shuffle:false},g;h=d.extend({},f,h);g=this.images[this.current];this.setImages(h.images,h.shuffle);if(g!==this.images[this.current]){this.changeImage()}};a.prototype.toggleType=function(){var f=this,g;if(!this.running){g=this.type;this.running=true;this.type=(this.type==="cover")?"contain":"cover";if(f.transitionType){this.backgroundDiv.css(f.transitionClass).addClass("fadeout").bind(this.transitionType,function(){d(this).removeClass(g);if(!e.backgroundsize){f.resizeImage()}d(this).addClass(f.type).removeClass("fadeout").unbind(f.transitionType).bind(f.transitionType,function(){f.running=false;d(this).unbind(f.transitionType)})})}else{this.backgroundDiv.fadeOut("",function(){d(this).removeClass(g);if(!e.backgroundsize){f.resizeImage()}d(this).addClass(f.type).fadeIn("",function(){f.running=false})})}}return};a.prototype.next=function(){if(this.running){return}this.current=(this.current===this.imagesMax)?0:this.current+1;return this.changeImage()};a.prototype.previous=function(){if(this.running){return}this.current=(this.current===0)?this.imagesMax:this.current-1;return this.changeImage()};a.prototype.changeTo=function(f){if(f<=this.imagesMax&&f>=0&&f!==this.current){this.current=f;return this.changeImage()}return};a.prototype.detectTransitionType=function(){var f={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionEnd"};return e.csstransitions?f[e.prefixed("transition")]:false};a.prototype.addBackgroundImage=function(g){if(this.backgroundDiv===undefined){if(this.transitionType){this.backgroundDiv=d(a.prototype.emptyDiv).addClass("fadeout").appendTo("body")}else{this.backgroundDiv=d(a.prototype.emptyDiv).hide().appendTo("body")}}var f=this.backgroundDiv;if(!e.backgroundsize){f.append('<img class="resizableImage" src="'+g+'">');this.resizeImage();d(c).resize(this.resizeImage)}else{f.css("background-image","url("+g+")").addClass(this.type)}};a.prototype.resizeImage=function(){var i=d("img.resizableImage"),n=i.parent(),m=i.width(),l=i.height(),g=m/l,o=c.innerWidth,k=c.innerHeight,j=o/k,h=0,f=0;if(isNaN(j)){o=c.document.documentElement.clientWidth;k=c.document.documentElement.clientHeight;j=o/k}if(this.type==="contain"){if(g>j){l=o*l/m;m=o;f=(k-l)/2}else{m=k*m/l;l=k;h=(o-m)/2}}else{if(g>j){m=k*m/l;l=k;h=(o-m)/2}else{l=o*l/m;m=o;f=(k-l)/2}}n.width(o).height(k).css("overflow","hidden");i.attr("width",m).attr("height",l).css("margin",f+"px 0px 0px "+h+"px")};a.prototype.changeImage=function(){var f=this;if(!this.running){this.oldDiv=this.backgroundDiv;this.backgroundDiv=d(this.emptyDiv).insertBefore(this.oldDiv);this.running=true;this.loadingDiv.show();this.oldDiv.addClass("old").removeClass("new");this.hiddenImg.attr("src",f.images[f.current]);return}return};c.Gallery=a}(jQuery,Modernizr,window));